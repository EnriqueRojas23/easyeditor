!function(a,b,c){function d(a){this.elem=a.element,this.className=a.className||"easyeditor";var c=["bold","italic","link","h2","h3","h4","alignleft","aligncenter","alignright"];this.buttons=a.buttons||c,this.buttonsHtml=a.buttonsHtml||null,this.attachEvents()}d.prototype.attachEvents=function(){this.bootstrap(),this.addToolbar(),this.handleKeypress(),this.handleResizeImage(),this.utils()},d.prototype.bootstrap=function(){var b=this;a(b.elem).attr("contentEditable",!0).addClass(b.className).wrap('<div class="'+b.className+'-wrapper"></div>'),this.$wrapperElem=a(b.elem).parent()},d.prototype.handleKeypress=function(){var c=this;a(c.elem).keydown(function(a){return 13===a.keyCode?(b.execCommand("insertHTML",!1,"<br><br>"),!1):void 0}),b.getElementById(c.elem.substr(1)).addEventListener("paste",function(a){a.preventDefault();var c=a.clipboardData.getData("text/plain").replace(/\n/gi,"<br>");b.execCommand("insertHTML",!1,c)})},d.prototype.addToolbar=function(){var b=this;a(b.elem).before('<div class="'+b.className+'-toolbar"><ul></ul></div>'),this.$toolbarContainer=this.$wrapperElem.find("."+b.className+"-toolbar"),this.populateButtons()},d.prototype.injectButton=function(a){var b=this;null!==b.buttonsHtml&&void 0!==b.buttonsHtml[a.buttonIdentifier]&&(a.buttonHtml=b.buttonsHtml[a.buttonIdentifier]),a.buttonHtml&&b.$toolbarContainer.find("ul").append('<li><button class="toolbar-'+a.buttonIdentifier+'" title="'+a.buttonIdentifier.replace(/\W/g," ")+'">'+a.buttonHtml+"</button></li>"),"function"==typeof a.clickHandler&&b.$toolbarContainer.find(".toolbar-"+a.buttonIdentifier).click(a.clickHandler)},d.prototype.populateButtons=function(){var b=this;a.each(b.buttons,function(a,c){"function"==typeof b[c]&&b[c]()})},d.prototype.handleResizeImage=function(){var c=this;a(c.elem).delegate("figure","click",function(b){b.stopPropagation(),a(this).addClass("is-resizable")}),a(c.elem).delegate("figure.is-resizable","mousemove",function(){a(this).find("img").css({width:a(this).width()+"px"})}),a(b).click(function(){a(c.elem).find("figure").removeClass("is-resizable")})},d.prototype.getSelection=function(){if(c.getSelection){var a=c.getSelection();if(a.rangeCount)return a}return!1},d.prototype.removeFormatting=function(c){var d=this,e=c.inFullArea;if(e===!1){var f=d.getSelection(),g=f.toString();if(f&&g.length>0){var h=f.getRangeAt(0),i=a(h.commonAncestorContainer.parentNode);if(i.attr("class")===d.className||i.attr("class")===d.className+"-wrapper"){var j=b.createElement("span");a(j).attr("data-value","temp").html(g.replace(/\n/gi,"<br>")),h.deleteContents(),h.insertNode(j),a('[data-value="temp"]').contents().unwrap()}else i.contents().unwrap()}}else a(d.elem).html(a(d.elem).text().replace(/\n/gi,"<br>"));d.removeEmptyTags()},d.prototype.removeEmptyTags=function(){var b=this;a(b.elem).html(a(b.elem).html().replace(/(<(?!\/)[^>]+>)+(<\/[^>]+>)+/,""))},d.prototype.wrapSelectionWithNodeName=function(c){var d=this,e={name:"span",blockElement:!1,style:null,"class":null,attribute:null,keepHtml:!1};"string"==typeof c?e.name=c:(e.name=c.nodeName||e.name,e.blockElement=c.blockElement||e.blockElement,e.style=c.style||e.style,e["class"]=c["class"]||e["class"],e.attribute=c.attribute||e.attribute,e.keepHtml=c.keepHtml||e.keepHtml);var f=d.getSelection();if(f&&f.toString().length>0&&f.rangeCount){if(d.isAlreadyWrapped(f,e))return d.removeWrappedFormatting(f,e),!1;var g=f.getRangeAt(0).cloneRange(),h=b.createElement(e.name);if((null!==e.style||null!==e["class"]||null!==e.attribute)&&(h=d.addAttribute(h,e)),d.selectionContainsHtml(g)){if(g=f.getRangeAt(0),e.keepHtml===!0){var i=g.cloneContents(),j=b.createElement("div");j.appendChild(i),a(h).html(j.innerHTML)}else h.textContent=f.toString();g.deleteContents(),g.insertNode(h),g.commonAncestorContainer.localName===e.name&&(a(g.commonAncestorContainer).contents().unwrap(),d.removeEmptyTags())}else g.surroundContents(h),f.removeAllRanges(),f.addRange(g);f.removeAllRanges()}},d.prototype.selectionContainsHtml=function(a){var b=this;return a.startContainer.parentNode.className===b.className+"-wrapper"?!1:!0},d.prototype.isAlreadyWrapped=function(b,c){var d=this,e=b.getRangeAt(0),f=a(e.commonAncestorContainer);return!f.parent().is(c.name)&&c.blockElement!==!0||f.parent().hasClass(d.className)!==!1?!1:!0},d.prototype.removeWrappedFormatting=function(b,c){var d=this,e=b.getRangeAt(0),f=a(e.commonAncestorContainer);(f.parent().is(c.name)||c.blockElement===!0&&f.parent().hasClass(d.className)===!1&&f.parent().hasClass(d.className+"-wrapper")===!1&&0===f.parent().find("."+d.className).length)&&f.unwrap(),d.removeEmptyTags()},d.prototype.addAttribute=function(b,c){return null!==c.style&&a(b).attr("style",c.style),null!==c["class"]&&a(b).addClass(c["class"]),null!==c.attribute&&a(b).attr(c.attribute[0],c.attribute[1]),b},d.prototype.insertAtCaret=function(b){var c=this;if(c.getSelection()){var d=c.getSelection().getRangeAt(0);d.insertNode(b)}else a(b).appendTo(c.elem)},d.prototype.insertHtml=function(b){var c=this;a(c.elem).find("temp").html(b)},d.prototype.utils=function(){var b=this;a("."+b.className+"-modal-close").click(function(){b.closeModal("#"+a(this).closest("."+b.className+"-modal").attr("id"))})},d.prototype.getYoutubeVideoIdFromUrl=function(a){if(0===a.length)return!1;var b="";return a=a.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),void 0!==a[2]?(b=a[2].split(/[^0-9a-z_\-]/i),b=b[0]):b=a,b},d.prototype.openModal=function(c){var d=b.createElement("temp");d.textContent=".",this.insertAtCaret(d),a(c).removeClass("is-hidden")},d.prototype.closeModal=function(b){var c=this;a(b).addClass("is-hidden").find("input").val(""),a(b).find("."+c.className+"-modal-content-body-loader").css("width","0");var d=a(this.elem).find("temp");"."===d.html()?d.remove():d.contents().unwrap(),a(this.elem).focus()},d.prototype.bold=function(){var a=this,b={buttonIdentifier:"bold",buttonHtml:"B",clickHandler:function(){a.wrapSelectionWithNodeName("b")}};a.injectButton(b)},d.prototype.italic=function(){var a=this,b={buttonIdentifier:"italic",buttonHtml:"I",clickHandler:function(){a.wrapSelectionWithNodeName("i")}};a.injectButton(b)},d.prototype.h2=function(){var a=this,b={buttonIdentifier:"header-2",buttonHtml:"H2",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"h2",blockElement:!0})}};a.injectButton(b)},d.prototype.h3=function(){var a=this,b={buttonIdentifier:"header-3",buttonHtml:"H3",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"h3",blockElement:!0})}};a.injectButton(b)},d.prototype.h4=function(){var a=this,b={buttonIdentifier:"header-4",buttonHtml:"H4",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"h4",blockElement:!0})}};a.injectButton(b)},d.prototype.x=function(){var a=this,b={buttonIdentifier:"remove-formatting",buttonHtml:"x",clickHandler:function(){a.removeFormatting({inFullArea:!1})}};a.injectButton(b)},d.prototype.alignleft=function(){var a=this,b={buttonIdentifier:"align-left",buttonHtml:"Align left",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: left","class":"text-left",keepHtml:!0})}};a.injectButton(b)},d.prototype.aligncenter=function(){var a=this,b={buttonIdentifier:"align-center",buttonHtml:"Align center",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: center","class":"text-center",keepHtml:!0})}};a.injectButton(b)},d.prototype.alignright=function(){var a=this,b={buttonIdentifier:"align-right",buttonHtml:"Align right",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: right","class":"text-right",keepHtml:!0})}};a.injectButton(b)},d.prototype.quote=function(){var a=this,b={buttonIdentifier:"quote",buttonHtml:"Quote",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"blockquote"})}};a.injectButton(b)},d.prototype.code=function(){var a=this,b={buttonIdentifier:"code",buttonHtml:"Code",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"pre"})}};a.injectButton(b)},d.prototype.link=function(){var a=this,b={buttonIdentifier:"link",buttonHtml:"Link",clickHandler:function(){a.wrapSelectionWithNodeName({nodeName:"a",attribute:["href",prompt("Insert link","")]})}};a.injectButton(b)},c.EasyEditor=d}(jQuery,document,window);
